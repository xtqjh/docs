(window.webpackJsonp=window.webpackJsonp||[]).push([[8],{355:function(t,s,a){"use strict";a.r(s);var e=a(42),n=Object(e.a)({},(function(){var t=this,s=t.$createElement,a=t._self._c||s;return a("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[a("h1",{attrs:{id:"typescript-jest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#typescript-jest"}},[t._v("#")]),t._v(" typescript & jest")]),t._v(" "),a("p",[t._v("以 react 项目为例")]),t._v(" "),a("h2",{attrs:{id:"安装"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#安装"}},[t._v("#")]),t._v(" 安装")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" jest ts-jest @types/jest -D\n")])])]),a("h2",{attrs:{id:"创建-jest-配置文件"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#创建-jest-配置文件"}},[t._v("#")]),t._v(" 创建 jest 配置文件")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ npx ts-jest config:init\n")])])]),a("p",[a("code",[t._v("ts-jest")]),t._v(" 可以在测试用例中进行类型检查")]),t._v(" "),a("h2",{attrs:{id:"测试-react-dom"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试-react-dom"}},[t._v("#")]),t._v(" 测试 react dom")]),t._v(" "),a("p",[t._v("这里选用 "),a("code",[t._v("enzyme")]),t._v(" 和 "),a("code",[t._v("enzyme-adapter-react-16")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/airbnb/enzyme",target:"_blank",rel:"noopener noreferrer"}},[t._v("Enzyme"),a("OutboundLink")],1),t._v(" 为 Airbnb 开发的测试工具.")]),t._v(" "),a("p",[a("code",[t._v("enzyme-adapter-react-16")]),t._v(" 为 React 版本安装适配器.")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" enzyme @types/enzyme enzyme-adapter-react-16 @types/enzyme-adapter-react-16 -D\n")])])]),a("p",[t._v("使用 chai 做断言")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" chai @types/chai -D\n")])])]),a("h2",{attrs:{id:"enzyme-结合-jest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#enzyme-结合-jest"}},[t._v("#")]),t._v(" enzyme 结合 jest")]),t._v(" "),a("p",[t._v("配置文件")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// jest.config.js")]),t._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("require")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'path'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  preset"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts-jest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  transform"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 哪些文件需要用 ts-jest 执行")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'^.+\\\\.tsx?$'")]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts-jest'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  testRegex"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'(/__test__/.*|(\\\\.|/)(test|spec))\\\\.[jt]sx?$'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// Jest使用模式或模式来检测测试文件")]),t._v("\n  moduleFileExtensions"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'ts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'tsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'js'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsx'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'json'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  testEnvironment"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'node'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  setupFilesAfterEnv"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("path"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'./setup-enzyme.ts'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[t._v("setup-enzyme.ts")]),t._v(" "),a("div",{staticClass:"language-ts extra-class"},[a("pre",{pre:!0,attrs:{class:"language-ts"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// setup-enzyme.ts")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Enzyme "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'enzyme'")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Adapter "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'enzyme-adapter-react-16'")]),t._v("\n\nEnzyme"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("configure")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  adapter"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Adapter")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),a("p",[t._v("示例看 "),a("code",[t._v("/src/components/")])]),t._v(" "),a("h2",{attrs:{id:"shallow、mount、render"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#shallow、mount、render"}},[t._v("#")]),t._v(" shallow、mount、render")]),t._v(" "),a("p",[a("code",[t._v("shallow")]),t._v(" 渲染叫浅渲染，仅仅对当前 "),a("code",[t._v("jsx")]),t._v(" 结构内的顶级组件进行渲染，而不对这些组件的内部子组件进行渲染，因此，它的性能上最快的，大部分情况下，如果不深入组件内部测试，那么可以使用 "),a("code",[t._v("shallow")]),t._v(" 渲染。")]),t._v(" "),a("p",[a("code",[t._v("mount")]),t._v(" 则会进行完整渲染，而且完全依赖 DOM API，也就是说 "),a("code",[t._v("mount")]),t._v(" 渲染的结果和浏览器渲染结果说一样的，结合 "),a("code",[t._v("jsdom")]),t._v(" 这个工具，可以对上面提到的有内部子组件实现复杂交互功能的组件进行测试。")]),t._v(" "),a("p",[a("code",[t._v("render")]),t._v(" 也会进行完整渲染，但不依赖 DOM API，而是渲染成 HTML 结构，并利用 "),a("code",[t._v("cheerio")]),t._v(" 实现 "),a("code",[t._v("html")]),t._v(" 节点的选择，它相当于只调用了组件的 "),a("code",[t._v("render")]),t._v(" 方法，得到 "),a("code",[t._v("jsx")]),t._v(" 并转码为 "),a("code",[t._v("html")]),t._v("，所以组件的生命周期方法内的逻辑都测试不到，所以render常常只用来测试一些数据（结构）一致性对比的场景。"),a("code",[t._v("shallow")]),t._v(" 实际上也测试不到 "),a("code",[t._v("componentDidMount")]),t._v(" / "),a("code",[t._v("componentDidUpdate")]),t._v(" 这两个方法内的逻辑。")]),t._v(" "),a("h2",{attrs:{id:"css-modules-结合-jest"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#css-modules-结合-jest"}},[t._v("#")]),t._v(" css-modules 结合 jest")]),t._v(" "),a("p",[t._v("安装 "),a("a",{attrs:{href:"https://github.com/keyz/identity-obj-proxy",target:"_blank",rel:"noopener noreferrer"}},[t._v("identity-obj-proxy"),a("OutboundLink")],1)]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" identity-obj-proxy -D\n")])])]),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// jest.config.js")]),t._v("\n\nmodule"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  moduleNameMapper"),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"\\\\.(css|less|scss)$"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"identity-obj-proxy"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v("...")]),t._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])]),a("p",[a("a",{attrs:{href:"https://jestjs.io/docs/en/webpack",target:"_blank",rel:"noopener noreferrer"}},[t._v("文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://stackoverflow.com/questions/41040269/syntax-error-when-test-component-with-sass-file-imported",target:"_blank",rel:"noopener noreferrer"}},[t._v("解决问题"),a("OutboundLink")],1)]),t._v(" "),a("h2",{attrs:{id:"测试报告"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#测试报告"}},[t._v("#")]),t._v(" 测试报告")]),t._v(" "),a("p",[t._v("设置 "),a("code",[t._v("script")])]),t._v(" "),a("div",{staticClass:"language-json extra-class"},[a("pre",{pre:!0,attrs:{class:"language-json"}},[a("code",[t._v("  "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"scripts"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),a("span",{pre:!0,attrs:{class:"token property"}},[t._v('"test"')]),a("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v('"jest --collect-coverage"')]),t._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n")])])]),a("p",[t._v("或配置中设置 "),a("code",[t._v("collectCoverage: true")])]),t._v(" "),a("h2",{attrs:{id:"问题解决"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#问题解决"}},[t._v("#")]),t._v(" 问题解决")]),t._v(" "),a("ul",[a("li",[t._v("It looks like you called "),a("code",[t._v("mount()")]),t._v(" without a global document being loaded.")])]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/airbnb/enzyme/issues/341",target:"_blank",rel:"noopener noreferrer"}},[t._v("issues341"),a("OutboundLink")],1)]),t._v(" "),a("p",[t._v("解决方案：")]),t._v(" "),a("p",[t._v("安装 jsdom jsdom-global")]),t._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[t._v("$ "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("yarn")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[t._v("add")]),t._v(" jsdom jsdom-global -D\n")])])]),a("p",[t._v("在引入 "),a("code",[t._v("react")]),t._v(" 之前，文件顶部设置如下")]),t._v(" "),a("div",{staticClass:"language-js extra-class"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[t._v("'jsdom-global/register'")]),t._v("\n")])])]),a("h2",{attrs:{id:"链接"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#链接"}},[t._v("#")]),t._v(" 链接")]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/dengwb1991/typescript-in-action/tree/master/jest-actions/ts-react-jest",target:"_blank",rel:"noopener noreferrer"}},[t._v("react示例"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/dengwb1991/typescript-in-action/tree/master/jest-actions/ts-jest",target:"_blank",rel:"noopener noreferrer"}},[t._v("jest简单示例"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://jestjs.io/",target:"_blank",rel:"noopener noreferrer"}},[t._v("Jest 官网文档"),a("OutboundLink")],1)]),t._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/airbnb/enzyme",target:"_blank",rel:"noopener noreferrer"}},[t._v("enzyme"),a("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=n.exports}}]);